<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>mini-memory.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    <h2><a href="index.html">Home</a></h2><h2><a href="http://www.emresakarya.com/mini-memory" target="_blank" class="menu-item" id="demo_link" >Demo Website</a></h2><h2><a href="https://codepen.io/softberry/pen/dwBrNB" target="_blank" class="menu-item" id="codepen_link" >Playground</a></h2><h2><a href="http://github.com/softberry/memory-game" target="_blank" class="menu-item" id="github_link" >GitHub</a></h2><h3>Classes</h3><ul><li><a href="MemoryCanvaslist.html">MemoryCanvaslist</a><ul class='methods'><li data-type='method' style='display: none;'><a href="MemoryCanvaslist.html#addCanvas">addCanvas</a></li><li data-type='method' style='display: none;'><a href="MemoryCanvaslist.html#randomPair">randomPair</a></li></ul></li><li><a href="Counter.html">Counter</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Counter.html#reset">reset</a></li><li data-type='method' style='display: none;'><a href="Counter.html#start">start</a></li><li data-type='method' style='display: none;'><a href="Counter.html#diff">diff</a></li><li data-type='method' style='display: none;'><a href="Counter.html#stop">stop</a></li></ul></li><li><a href="Fallback.html">Fallback</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Fallback.html#init">init</a></li><li data-type='method' style='display: none;'><a href="Fallback.html#picsum">picsum</a></li><li data-type='method' style='display: none;'><a href="Fallback.html#getFreeId">getFreeId</a></li></ul></li><li><a href="FullScreen.html">FullScreen</a><ul class='methods'><li data-type='method' style='display: none;'><a href="FullScreen.html#enter">enter</a></li><li data-type='method' style='display: none;'><a href="FullScreen.html#exit">exit</a></li></ul></li><li><a href="Game.html">Game</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Game.html#addImage">addImage</a></li><li data-type='method' style='display: none;'><a href="Game.html#prepare">prepare</a></li><li data-type='method' style='display: none;'><a href="Game.html#openCard">openCard</a></li><li data-type='method' style='display: none;'><a href="Game.html#closeCard">closeCard</a></li><li data-type='method' style='display: none;'><a href="Game.html#drawImageOnCanvas">drawImageOnCanvas</a></li><li data-type='method' style='display: none;'><a href="Game.html#nextLevel">nextLevel</a></li></ul></li><li><a href="Localization.html">Localization</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Localization.html#message">message</a></li><li data-type='method' style='display: none;'><a href="Localization.html#sample">sample</a></li><li data-type='method' style='display: none;'><a href="Localization.html#update">update</a></li></ul></li><li><a href="MemoryImageList.html">MemoryImageList</a><ul class='methods'><li data-type='method' style='display: none;'><a href="MemoryImageList.html#random">random</a></li></ul></li><li><a href="ImageServer.html">ImageServer</a><ul class='methods'><li data-type='method' style='display: none;'><a href="ImageServer.html#getCardImages">getCardImages</a></li><li data-type='method' style='display: none;'><a href="ImageServer.html#done">done</a></li></ul></li><li><a href="AMP.html">AMP</a><ul class='methods'><li data-type='method' style='display: none;'><a href="AMP.html#markup">markup</a></li></ul></li><li><a href="NextLevel.html">NextLevel</a><ul class='methods'><li data-type='method' style='display: none;'><a href="NextLevel.html#init">init</a></li><li data-type='method' style='display: none;'><a href="NextLevel.html#show">show</a></li><li data-type='method' style='display: none;'><a href="NextLevel.html#hide">hide</a></li><li data-type='method' style='display: none;'><a href="NextLevel.html#getAmpMarkup">getAmpMarkup</a></li></ul></li><li><a href="Settings.html">Settings</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Settings.html#updateChildren">updateChildren</a></li><li data-type='method' style='display: none;'><a href="Settings.html#reset">reset</a></li><li data-type='method' style='display: none;'><a href="Settings.html#enableApplyButton">enableApplyButton</a></li><li data-type='method' style='display: none;'><a href="Settings.html#show">show</a></li><li data-type='method' style='display: none;'><a href="Settings.html#hide">hide</a></li></ul></li><li><a href="SocialButtons.html">SocialButtons</a><ul class='methods'><li data-type='method' style='display: none;'><a href="SocialButtons.html#html">html</a></li><li data-type='method' style='display: none;'><a href="SocialButtons.html#getShareButton">getShareButton</a></li><li data-type='method' style='display: none;'><a href="SocialButtons.html#getSocialMediaOptions">getSocialMediaOptions</a></li></ul></li><li><a href="MemoryPairsList.html">MemoryPairsList</a><ul class='methods'><li data-type='method' style='display: none;'><a href="MemoryPairsList.html#checkMark">checkMark</a></li><li data-type='method' style='display: none;'><a href="MemoryPairsList.html#hasPair">hasPair</a></li><li data-type='method' style='display: none;'><a href="MemoryPairsList.html#arePairs">arePairs</a></li><li data-type='method' style='display: none;'><a href="MemoryPairsList.html#getImage">getImage</a></li></ul></li><li><a href="CurrentPlayer.html">CurrentPlayer</a><ul class='methods'><li data-type='method' style='display: none;'><a href="CurrentPlayer.html#addScore">addScore</a></li><li data-type='method' style='display: none;'><a href="CurrentPlayer.html#table">table</a></li></ul></li><li><a href="Scores.html">Scores</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Scores.html#addPlayer">addPlayer</a></li></ul></li><li><a href="Limits.html">Limits</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Limits.html#defined">defined</a></li><li data-type='method' style='display: none;'><a href="Limits.html#exceeded">exceeded</a></li></ul></li><li><a href="MiniMemory.html">MiniMemory</a><ul class='members'><li data-type='member' style='display: none;'><a href="MiniMemory.html#toolbar">toolbar</a></li><li data-type='member' style='display: none;'><a href="MiniMemory.html#settings">settings</a></li><li data-type='member' style='display: none;'><a href="MiniMemory.html#layers">layers</a></li><li data-type='member' style='display: none;'><a href="MiniMemory.html#cardBack">cardBack</a></li><li data-type='member' style='display: none;'><a href="MiniMemory.html#.observedAttributes">observedAttributes</a></li></ul><ul class='methods'><li data-type='method' style='display: none;'><a href="MiniMemory.html#reset">reset</a></li><li data-type='method' style='display: none;'><a href="MiniMemory.html#connectedCallback">connectedCallback</a></li><li data-type='method' style='display: none;'><a href="MiniMemory.html#disconnectedCallback">disconnectedCallback</a></li><li data-type='method' style='display: none;'><a href="MiniMemory.html#adoptedCallback">adoptedCallback</a></li><li data-type='method' style='display: none;'><a href="MiniMemory.html#attributeChangedCallback">attributeChangedCallback</a></li><li data-type='method' style='display: none;'><a href="MiniMemory.html#checkDefaultAttributes">checkDefaultAttributes</a></li><li data-type='method' style='display: none;'><a href="MiniMemory.html#prepareMatrix">prepareMatrix</a></li><li data-type='method' style='display: none;'><a href="MiniMemory.html#myAttributes">myAttributes</a></li><li data-type='method' style='display: none;'><a href="MiniMemory.html#render">render</a></li></ul></li></ul><h3>Modules</h3><ul><li><a href="module-lib_tools_debounce.html">lib/tools/debounce</a></li><li><a href="module-lib_tools_image.html">lib/tools/image</a></li><li><a href="module-lib_tools_manifest.html">lib/tools/manifest</a></li><li><a href="module-lib_tools_middle.html">lib/tools/middle</a></li><li><a href="module-lib_tools_summary.html">lib/tools/summary</a></li><li><a href="module-lib_tools_tile.html">lib/tools/tile</a></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<div id="main">
    
    <h1 class="page-title">mini-memory.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { Localization } from './lib/i18n';
import { Game } from './lib/game';
import { Fallback } from './lib/fallback';
import { default as style } from './style.css';

import { debounce } from './lib/tools/debounce';

import { default as tmplToolbar } from './templates/toolbar.html';

import { Settings } from './lib/layers/settings';
import { NextLevel } from './lib/layers/nextlevel';
import { FullScreen } from './lib/fullscreen';
import { ImageServer } from './lib/image-server';

// Tools
import { Limits } from './lib/tools/limit';
import { newTile } from './lib/tools/tile';
import { oddMiddle } from './lib/tools/middle';
import { default as getManifestJson } from './lib/tools/manifest';

const observedAttributes = ['matrix', 'lang', 'view', 'settings', 'challenge'];
/**
 * @classdesc Main container of the game. Will be used as
 * {`CustomElements.define`} constructor.
 * @author Emre Sakarya &lt;emre.sakarya@softberry.de>
 * @extends HTMLElement
 * @example customElements.define('mini-memory', MiniMemory);
 * // Create MiniMemory DOMElement like this :
 * document.createElement('mini-memory');
 * // or like this:
 * &lt;mini-memory>&lt;/mini-memory>
 */
export class MiniMemory extends HTMLElement {
  /**
   * of the game. Will be used as ``{CustomElements.define}`` constructor.
   */
  constructor() {
    super();
    const self = this;
    this.i18n = new Localization();
    this.fullScreen = new FullScreen();
    this.imageServer = new ImageServer(this);
    this.manifest;
    this.rendered = false;
    this.images = [];
    this.tiles = [];

    window.addEventListener(
      'resize',
      debounce(() => {
        self.reset();
        self.render();
      }, 500)
    );

    /**
     * @summary HTMLDivElement information bar on top of the screen.
     */
    this.toolbar = document.createElement('div');

    /**
     * @summary Controls and keep track of game settings {@link Settings}.
     */
    this.settings = new Settings(this);
    /**
     * @summary handle of all layers such as loading, toolbar, setting etc.
     * which will be defined when they are created.
     */
    this.layers = {
      loading: null,
    };

    /**
     * @summary Image of the closed card drawn to be conatiner canvas
     */
    this.cardBack = document.createElement('img');
  }
  /**
   * @summary Resets all parameters to enable a clean restart/render.
   */
  reset() {
    this.rendered = false;
    this.images = [];
    this.tiles = [];
    this.layers = {
      loading: {},
      nextLevel: new NextLevel(this),
    };
  }

  /**
   * @summary Callback on custom element included in DOM.
   */
  connectedCallback() {
    if (!this.rendered) {
      this.render();
    }
  }

  /**
   * @summary Necessary attributes to be watched.
   */
  static get observedAttributes() {
    return observedAttributes;
  }

  /**
   * @summary Callback function on removing of custom element from DOM.
   */
  disconnectedCallback() {}
  /**
   * @summary Callback function on adding of custom element to another DOM.
   */
  adoptedCallback() {}
  /**
   * callback function on attribute change of custom element.
   * @param {string} name Name of the attribute.
   * @param {string} oldVal Latest value before change.
   * @param {string} newVal The current value to be set.
   */
  attributeChangedCallback(name, oldVal, newVal) {
    const self = this;
    /**
     * Resets all parameters and renders game again.
     */
    function __fullReset() {
      self.reset();
      self.rendered = false;
      self.render();
    }

    switch (name) {
      case 'lang': {
        this.i18n = new Localization(newVal);
        this.i18n.update(this.shadowRoot);
        break;
      }
      case 'view': {
        if (newVal === 'fullscreen') {
          this.fullScreen.enter();
        } else {
          this.fullScreen.exit();
        }
        break;
      }
      case 'matrix': {
        __fullReset();
        break;
      }
      default: {
        // __fullReset();
      }
    }
  }
  /**
   * @summary check if element has manadatory fields defined or not.
   * @return {boolean} Returns true if minimum requirements
   * are correctly defined.
   */
  checkDefaultAttributes() {
    const attr = this.getAttribute('matrix');
    const limits = new Limits(2, 10, attr);
    if (!limits.defined()) {
      this.shadowRoot.innerHTML += `
      ${this.i18n.message('MATRIX_DIMENSIONS_ERROR')}
      ${this.i18n.sample('MATRIX_DIMENSIONS_ERROR')}
      `;
      return false;
    }

    if (limits.exceeded(attr.split('x'))) {
      this.shadowRoot.innerHTML += `
      ${this.i18n.message('MATRIX_DIMENSIONS_ERROR')}
      ${this.i18n.sample('MATRIX_DIMENSIONS_ERROR')}
      `;
      return false;
    }

    return true;
  }

  /**
   * @summary Prepare cards layout using given matrix attribute.
   */
  prepareMatrix() {
    const matrix = this.getAttribute('matrix').split('x');
    matrix[0] = parseInt(matrix[0]);
    matrix[1] = parseInt(matrix[1]);

    const oddMid = oddMiddle(matrix);
    const cssRow = `width:${100 / matrix[0]}%;`;
    const cssCol = `height:${100 / matrix[1]}%;`;
    const squares = matrix[0] * matrix[1];
    const imageCount = squares % 2 === 0 ? squares / 2 : (squares - 1) / 2;

    const self = this;
    console.log(JSON.stringify(style));
    self.shadowRoot.innerHTML += `
    &lt;style>:host .tile {${cssRow + cssCol}}&lt;/style>`;
    let outer = 0;
    let inner = 0;
    let index = 0;
    const tilesContainer = document.createElement('div');
    const parentContainer =
      self.getAttribute('view') === 'fullscreen'
        ? {
            w: document.documentElement.offsetWidth,
            h: document.documentElement.offsetHeight,
          }
        : { w: self.parentNode.offsetWidth, h: self.parentNode.offsetHeight };

    const width = parseInt(parentContainer.w / matrix[0]);
    const height = parseInt(parentContainer.h / matrix[1]);

    tilesContainer.id = 'tiles-container';
    self.shadowRoot.appendChild(tilesContainer);
    for (outer = 0; outer &lt; matrix[0]; outer++) {
      for (inner = 0; inner &lt; matrix[1]; inner++) {
        index = inner + matrix[1] * outer;
        const tile = newTile(index);
        tilesContainer.appendChild(tile.tile);
        if (index !== oddMid) {
          tile.canvas.classList.add('wait');
          self.tiles.push(tile);
        }
      }
    }
    self.game = new Game(
      this.tiles.map((t) => t.canvas),
      this.cardBack
    );

    self.game.events.addEventListener('ready', (e) => {
      self.shadowRoot.querySelector('#loading').classList.add('done');
      self.game.counter.reset(self.shadowRoot.querySelector('#counter'));
    });

    self.game.events.addEventListener('win', (e) => {
      const attr = self.myAttributes();
      const nextLevelMatrix = self.game.nextLevel(attr);
      self.settings.scores.currentPlayer.addScore(
        attr.matrix,
        self.game.counter
      );

      if (attr.challenge === 'off') {
        self.reset();
        self.render();
      } else {
        self.setAttribute('matrix', nextLevelMatrix);
      }
    });

    getManifestJson()
      .then((manifest) => {
        self.manifest = manifest;

        return self.imageServer
          .getCardImages({ width, height, imageCount })
          .catch((e) => {
            new Fallback(self, { width, height, imageCount });
          });
      })
      .catch((e) => {
        new Fallback(self, { width, height, imageCount });
      });
  }

  /**
   * Gets current attributes according to observedAttributes.
   * @return {object} attr Obeserved values object.
   */
  myAttributes() {
    const attr = {};

    observedAttributes.forEach((oa) => {
      attr[oa] = this.getAttribute(oa);
    });

    return attr;
  }
  /**
   * @summary Renders custom element with initial attributes.
   */
  render() {
    const self = this;
    if (self.rendered) {
      return;
    }
    self.i18n = new Localization(self.getAttribute('lang'));
    self.rendered = true;

    if (!self.shadowRoot) {
      self.attachShadow({ mode: 'open' });
    }

    self.shadowRoot.innerHTML = `&lt;style>${style}&lt;/style>`;
    if (!self.checkDefaultAttributes()) {
      self.i18n.update(self.shadowRoot);
      return;
    }

    self.shadowRoot.innerHTML = `
    &lt;style>${style}&lt;/style>
      ${tmplToolbar}
      ${self.settings.html}
      ${self.layers.nextLevel.html}
          &lt;div id="loading">
              &lt;div class="lastScore">${
                self.settings.scores.currentPlayer.lastGame
              }
              &lt;/div>
            &lt;div class="goto next level">${self.i18n.message('LOADING')}&lt;/div>
          &lt;/div>`;

    self.prepareMatrix();
    self.i18n.update(self.shadowRoot);

    self.settings.updateChildren(self.shadowRoot);
    self.layers.toolbar = {
      counter: this.shadowRoot.querySelector('#counter'),
      player: this.shadowRoot.querySelector('#player'),
      menu: this.shadowRoot.querySelector('#menu'),
    };

    self.settings.reset(self.myAttributes());

    self.layers.toolbar.menu.addEventListener('click', () => {
      self.settings.reset(self.myAttributes());
      self.settings.show();
    });

    self.layers.nextLevel.init();
    self.layers.nextLevel.show();
  }
}
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a> using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>


<script src="scripts/collapse.js" defer></script>


</body>
</html>
